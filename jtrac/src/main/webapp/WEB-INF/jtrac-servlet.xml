<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!-- application context definition for "jtrac" Dispatcher Servlet (Spring MVC front controller) -->

<beans> 

    <!-- multipart resolver for file upload handling  --> 
    <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <property name="maxUploadSize" value="5120000"/>
    </bean>	    
    
    <!--
    - This sets up a uniform short-cut way to map the view logical name (with JSTL support)
    - to the actual web resource (jsp).  A more complex mapping can be done with a resource bundle
    -->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
        <property name="prefix" value="/WEB-INF/jsp/"/>
        <property name="suffix" value=".jsp"/>
    </bean>
    
    <!-- explicit URL mapper used by the "jtrac" DispatcherServlet -->    
    <bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="interceptors">
            <list>
                <bean class="org.springframework.orm.hibernate3.support.OpenSessionInViewInterceptor">
                    <property name="sessionFactory" ref="sessionFactory"/>
                </bean>
            </list>
        </property>
        <property name="alwaysUseFullPath" value="true"/>
        <property name="mappings">
            <props>
                <prop key="/flow.htm">flowController</prop>
                <!-- =========================================== -->
                <prop key="/dashboard.htm">urlController</prop>
                <prop key="/options.htm">urlController</prop>
                <prop key="/svn_form.htm">urlController</prop>
                <!-- =========================================== -->
                <prop key="/login.htm">defaultController</prop>                
                <prop key="/logout.htm">defaultController</prop>                
                <prop key="/user_list.htm">defaultController</prop>
                <prop key="/space_list.htm">defaultController</prop>
                <prop key="/config_list.htm">defaultController</prop>
                <prop key="/svn_view.htm">defaultController</prop>
                <prop key="/attachments/*">defaultController</prop>
                <prop key="/chart/svn_commits_per_committer.jpg">defaultController</prop>
            </props>
        </property>
    </bean>    
    
    <!-- for cases where a JSP view can be directly rendered without invoking any backend methods  -->      
    <bean id="urlController" class="org.springframework.web.servlet.mvc.UrlFilenameViewController"/>
    
    <!--
    - This is a MultiActionController that manages simple view rendering where backend services 
    - are invoked but there is no need for form binding or a FormController
    -->
    <bean id="defaultController" class="info.jtrac.web.DefaultMultiActionController">
        <property name="methodNameResolver">
            <bean class="org.springframework.web.servlet.mvc.multiaction.PropertiesMethodNameResolver">
                <property name="alwaysUseFullPath" value="true"/>
                <property name="mappings">
                    <props>
                        <prop key="/login.htm">loginHandler</prop>
                        <prop key="/logout.htm">logoutHandler</prop>
                        <prop key="/user_list.htm">userListHandler</prop>
                        <prop key="/space_list.htm">spaceListHandler</prop>
                        <prop key="/config_list.htm">configListHandler</prop>
                        <prop key="/svn_view.htm">svnViewHandler</prop>
                        <prop key="/attachments/*">attachmentViewHandler</prop>
                        <prop key="/chart/svn_commits_per_committer.jpg">svnCommitsPerCommitterChartHandler</prop>
                    </props>
                </property>
            </bean>        
        </property>
        <property name="jtrac" ref="jtrac"/>
    </bean>    
    
    <!-- ======================== SPRING WEB FLOW ============================ -->
    
    <!-- common web flow controller for all spring web flows 
    - The flow id of the flow to start should be passed in 
    - using the "_flowId" request parameter
    -->
    <bean id="flowController" class="org.springframework.webflow.executor.mvc.FlowController">       
        <property name="flowExecutor">
            <bean class="org.springframework.webflow.executor.FlowExecutorImpl">
                <constructor-arg>
                    <bean class="org.springframework.webflow.registry.XmlFlowRegistryFactoryBean">
                        <property name="flowLocations" value="/WEB-INF/flow/*.xml"/>
                    </bean>             
                </constructor-arg>
            </bean>     
        </property>
    </bean>         
    
    <bean id="itemFormAction" class="info.jtrac.webflow.ItemFormAction">
        <property name="jtrac" ref="jtrac"/>
    </bean>    
    
    <bean id="itemViewFormAction" class="info.jtrac.webflow.ItemViewFormAction">
        <property name="jtrac" ref="jtrac"/>
    </bean>      
    
    <bean id="userFormAction" class="info.jtrac.webflow.UserFormAction">
        <property name="jtrac" ref="jtrac"/>
    </bean>
    
    <bean id="spaceFormAction" class="info.jtrac.webflow.SpaceFormAction">
        <property name="jtrac" ref="jtrac"/>
    </bean>
    
    <bean id="fieldFormAction" class="info.jtrac.webflow.FieldFormAction"/>
    
    <bean id="itemSearchFormAction" class="info.jtrac.webflow.ItemSearchFormAction">
        <property name="jtrac" ref="jtrac"/>
    </bean>
      
    <bean id="configFormAction" class="info.jtrac.webflow.ConfigFormAction">
        <property name="jtrac" ref="jtrac"/>
    </bean>    
        
</beans>
