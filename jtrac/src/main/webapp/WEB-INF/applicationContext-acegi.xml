<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!-- Acegi security configuration as Spring context -->

<beans>
	
    <!-- Automatically receives AuthenticationEvent messages -->
    <bean id="loggerListener" class="org.acegisecurity.event.authentication.LoggerListener"/>    
    
    <bean id="authenticationManager" class="org.acegisecurity.providers.ProviderManager">
        <property name="providers">
            <list>
                <bean class="org.acegisecurity.providers.dao.DaoAuthenticationProvider">
                    <property name="userDetailsService" ref="jtrac"/>
                    <property name="passwordEncoder" ref="passwordEncoder"/>
                </bean> 
                <bean class="org.acegisecurity.providers.anonymous.AnonymousAuthenticationProvider">
                    <property name="key" value="jtrac-anon"/>
                </bean>
                <bean class="org.acegisecurity.providers.rememberme.RememberMeAuthenticationProvider">
                    <property name="key" value="jtrac-reme"/>
                </bean>		   
            </list>
        </property>
    </bean>  	
   		
    <bean id="filterChainProxy" class="org.acegisecurity.util.FilterChainProxy">
        <property name="filterInvocationDefinitionSource">
            <value>
                PATTERN_TYPE_APACHE_ANT
                /index.jsp=
                /test/**=
                /resources/**=
                /calendar/**=
                /chart/*=
                /svn_*=
                /**=httpFilter,authenticationFilter,rememberMeFilter,anonFilter,authorizationFilter
            </value>
        </property>
    </bean>
    
    <!-- has to be first in the filter chain, this injects the security / session context for all the rest -->
    <bean id="httpFilter" class="org.acegisecurity.context.HttpSessionContextIntegrationFilter"/>    
    
    <bean id="authenticationFilter" class="org.acegisecurity.ui.webapp.AuthenticationProcessingFilter">
        <property name="authenticationManager" ref="authenticationManager"/>
        <property name="authenticationFailureUrl" value="/login.htm?error=true"/>
        <property name="defaultTargetUrl" value="/dashboard.htm"/>
        <property name="filterProcessesUrl" value="/j_acegi_security_check"/>
        <property name="rememberMeServices" ref="rememberMeServices"/>
    </bean>             

    <bean id="rememberMeFilter" class="org.acegisecurity.ui.rememberme.RememberMeProcessingFilter">
        <property name="rememberMeServices" ref="rememberMeServices"/>
    </bean>
   
    <bean id="rememberMeServices" class="org.acegisecurity.ui.rememberme.TokenBasedRememberMeServices">
        <property name="userDetailsService" ref="jtrac"/>
        <property name="key" value="jtrac-reme"/>
    </bean>        

    <bean id="anonFilter" class="org.acegisecurity.providers.anonymous.AnonymousProcessingFilter">
        <property name="key" value="jtrac-anon"/>
        <property name="userAttribute" value="anonymousUser,ROLE_ANONYMOUS"/>
    </bean> 
    
    <bean id="authorizationFilter" class="org.acegisecurity.intercept.web.SecurityEnforcementFilter">
        <property name="filterSecurityInterceptor">
            <bean class="org.acegisecurity.intercept.web.FilterSecurityInterceptor">
                <property name="authenticationManager" ref="authenticationManager"/>
                <property name="accessDecisionManager">
                    <bean class="org.acegisecurity.vote.AffirmativeBased">
                        <property name="allowIfAllAbstainDecisions" value="false"/>
                        <property name="decisionVoters">
                            <list>
                                <bean class="org.acegisecurity.vote.RoleVoter"/>
                            </list>
                        </property>
                    </bean>		      
                </property>     
                <property name="objectDefinitionSource">
                    <value>
                        PATTERN_TYPE_APACHE_ANT
                        /login.htm*=ROLE_ANONYMOUS,ROLE_USER
                        /logout.htm=ROLE_ANONYMOUS,ROLE_USER
                        /**=ROLE_USER
                    </value>
                </property>
            </bean>      
        </property>
        <property name="authenticationEntryPoint">
            <bean class="org.acegisecurity.ui.webapp.AuthenticationProcessingFilterEntryPoint">
                <property name="loginFormUrl" value="/login.htm"/>
            </bean>      
        </property>
    </bean>   
    
</beans>


